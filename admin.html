// ============ SIMPAN INFO TOKO ============
document.getElementById('save-store-info').addEventListener('click', async () => {
  const storeData = {
    status: document.getElementById('store-status').value,
    description: document.getElementById('store-description').value,
    contact: document.getElementById('store-contact').value,
    address: document.getElementById('store-address').value,
    hours: document.getElementById('store-hours').value,
    map: document.getElementById('store-map').value,
    bank: document.getElementById('store-bank').value,
    qris: document.getElementById('store-qris').value,
    image: "images/deskripsi.jpg" // default, bisa kamu ganti
  };

  try {
    const res = await fetch('/api/saveStore', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(storeData)
    });

    const result = await res.json();
    alert(result.message || 'Info toko berhasil disimpan');
  } catch (err) {
    console.error(err);
    alert('Gagal menyimpan info toko');
  }
});

// ============ SIMPAN PRODUK ============
let products = [];

document.getElementById('add-product').addEventListener('click', async () => {
  const product = {
    id: Date.now(),
    name: document.getElementById('product-name').value,
    price: parseInt(document.getElementById('product-price').value) || 0,
    stock: parseInt(document.getElementById('product-stock').value) || 0,
    category: document.getElementById('product-category').value || document.getElementById('new-category').value,
    description: document.getElementById('product-description').value,
    image: "images/" + document.getElementById('product-image').value,
    deliveryFee: document.getElementById('product-delivery-fee').checked,
    publish: document.getElementById('product-publish').checked,
    discountPrice: parseInt(document.getElementById('discount-price').value) || 0,
    discountQty: {
      min: parseInt(document.getElementById('discount-qty-min').value) || 0,
      price: parseInt(document.getElementById('discount-qty-price').value) || 0
    }
  };

  // tambahkan produk ke array
  products.push(product);

  try {
    const res = await fetch('/api/saveProducts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(products)
    });

    const result = await res.json();
    alert(result.message || 'Produk berhasil disimpan');
    renderProductList();
  } catch (err) {
    console.error(err);
    alert('Gagal menyimpan produk');
  }
});

// ============ RENDER PRODUK LIST DI ADMIN ============
function renderProductList() {
  const list = document.getElementById('product-list');
  list.innerHTML = '';
  products.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.name} - Rp ${p.price} (Stok: ${p.stock})`;
    list.appendChild(li);
  });
}

// ============ TAMBAH KATEGORI ============
document.getElementById('add-category-btn').addEventListener('click', () => {
  const newCat = document.getElementById('new-category').value;
  if (newCat) {
    const select = document.getElementById('product-category');
    const opt = document.createElement('option');
    opt.value = newCat;
    opt.textContent = newCat;
    select.appendChild(opt);
    select.value = newCat;
    document.getElementById('new-category').value = '';
  }
});
